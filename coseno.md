# La transformada discreta del coseno

Esta sección presenta una familia de variantes de la transformada de Fourier discreta que tienen por dominio e imagen secuencias o vectores de números reales, y describe su uso e interés en el diseño de algoritmos de compresión para imágenes y grabaciones de sonido.

<!-- TODO: anticipar con un poco más de detalle lo que se va a hacer -->

## Archivos multimedia

Desde tiempos remotos, el ser humano ha tenido la necesidad de representar imágenes y sonidos a través de distintas técnicas como la pintura, la notación musical, la fotografía o la grabación de sonido. Con el desarrollo de los ordenadores digitales, que permiten administrar información en forma de secuencias finitas de dígitos binarios o **bits**, surgió una nueva forma de almacenar sonidos e imágenes: los archivos multimedia.

Para obtener un archivo multimedia que codifique una imagen o un sonido, el procedimiento habitual se basa en muestrear y cuantizar su señal analógica asociada, medida mediante un instrumento mecánico o electromagnético. El muestreo consiste en medir un conjunto finito de valores relacionados con el fenómeno en cuestión: en caso de una imagen, se mide la intensidad de la luz en distintos puntos de la misma; en el sonido, la presión atmosférica en varios instantes. La cuantización asigna, para cada medida tomada, un valor en un conjunto finito, redondeando los valores medidos. De esta forma, estos fenómenos quedan registrados como un conjunto finito de dígitos que representan una versión aproximada de los mismos. Para recrear la imagen o el sonido se genera un fenómeno físico cuya señal analógica asociada se aproxime a la información digital almacenada, de forma que se genera una aproximación de la imagen o el sonido original.

En general el muestreo se produce a intervalos regulares: leyendo la presión atmosférica cada cierto tiempo en el caso del sonido o registrando las intensidades luminosas en los puntos de una rejilla sobre una imagen. El inverso de la longitud del intervalo temporal que separa muestras consecutivas se denomina **frecuencia de muestreo**, y la tupla de las dimensiones de la rejilla se llama **resolución**. La cuantización determina un subconjunto finito de números enteros que se pueden asignar a cada valor medido, y normalmente se elige el conjunto de números $\{0,\, 1,\, ...,\, 2^N - 1\}$ o el conjunto de números $\{-2^{N-1},\, -2^{N-1} + 1,\, ...,\, -1,\, 0,\, 1,\, ...,\, 2^N - 2\}$, con $N \in \mathbb N$, donde los valores son aproximadamente proporcionales a la intensidad medida (o a alguna transformación monótona de la misma, como la raíz cuadrada o el logaritmo). Ambos conjuntos tienen $2^N$ elementos, por lo que el valor de cada muestra se puede codificar con $N$ bits; en cuyo caso se denomina **profundidad de bits** al número $N$.

El formato de almacenamiento en bruto consiste en registrar el valor medido en cada muestra siguiendo algún orden canónico. Por ejemplo, dado un archivo de sonido en bruto, los primeros $N$ bits habitualmente representan la presión en el primer instante medido. Si un archivo contiene $M$ muestras medidas a una profundidad de bits de $N$, entonces el número de bits requeridos para almacenar el archivo es $N \cdot M$. De esta forma, según la frecuencia de muestreo (que es inversamente proporcional a $M$) o la resolución (el producto de sus dos valores es $M$) y según la profundidad de bits se tendrá un archivo de mayor o menor tamaño, que representará con menor o mayor fidelidad el fenómeno grabado. Sin embargo, la fidelidad es muy sensible a estos valores, por lo que en los archivos de sonido no es habitual que la frecuencia de muestreo sea inferior a $44100 Hz$ o que la profundidad de bits sea menor de $16$, y las imágenes fotográficas suelen tener una profundidad de bits de $24$ y una resolución cada vez mayor.

Los formatos de archivo multimedia más básicos almacenan entre otras cosas la profundidad de bits y la frecuencia de muestreo o la resolución en el inicio del archivo, y a continuación los datos en bruto. Para la mayoría de aplicaciones, estos formatos no resultan prácticos, pues los archivos ocupan un espacio excesivo. Ante este problema surgió la necesidad de obtener algoritmos de compresión multimedia, con el que poder obtener archivos de tamaño más manejable.

Un método para reducir el tamaño de los archivos es aplicar algoritmos de compresión sin pérdida de secuencias de bits genéricas, que eliminan la redundancia de la información de los archivos, de forma que se puede reconstruir el archivo digital original. Entre estos algoritmos están los métodos estadísticos, que en vez de almacenar los valores de cada muestra en un número fijo de bits intentan representar con menos bits los valores más comunes, y los métodos de diccionario, que almacenan en un diccionario secuencias de valores consecutivos comunes y, cuando estas aparecen, en lugar de reproducirlas escriben una referencia al diccionario. Sin embargo, estos procedimientos tienen un éxito discreto en las grabaciones de sonido y en las imágenes fotográficas, pues los valores medidos suelen seguir una distribución aproximadamente uniforme a lo largo de todo el rango de valores, y las ocurrencias de secuencias exactas de valores son poco frecuentes [@nelson1996data].

En contraposición a los algoritmos de compresión sin pérdida de secuencias de bits se tienen los algoritmos de compresión que aplican conocimiento experto sobre la secuencia de bits que reciben. Estos algoritmos aprovechan propiedades de las secuencias de bits de un tipo concreto para obtener, mediante una transformación invertible, una secuencia de menor longitud, consiguiendo así comprimir el archivo original, que se puede obtener aplicando la transformación inversa. La secuencia transformada se puede tratar de comprimir más con algoritmos como los expuestos en el apartado anterior, como se hace en el formato de imagen PNG y en el formato de sonido FLAC. Si se descarta parte de la secuencia transformada de forma que la parte que se almacene dé lugar a una versión razonablemente aproximada del archivo multimedia original, se puede obtener una compresión mayor: esto es lo que hacen los algoritmos de compresión con pérdida.

Un enfoque común a la hora de aplicar conocimiento experto al almacenamiento de archivos multimedia consiste en tratar la imagen o la grabación (o bloques de las mismas) como una combinación lineal de ondas básicas, almacenando los coeficientes de dicha combinación lineal en lugar de los valores en cada muestra. En esta situación es común almacenar solo los coeficientes de las ondas que las componen que se consideren adecuadas para representar el contenido multimedia con suficiente fidelidad. Para ello, dado que la información que tiene el ordenador es la representación digital de la imagen o el sonido, se puede utilizar una operación semejante a la transformada de Fourier discreta que trabaje con tuplas de números de un conjunto ordenado y finito, como puede ser un subconjunto finito de los números reales.

## Generalización de la transformada de Fourier discreta

La transformada de Fourier discreta se puede ver como un caso particular de las transformaciones [@oppenheim1999discrete] $\mathcal A : \mathbb C^N \to \mathbb C^N$ definidas para cada $\{x\} = x_0,\,\dots,\,x_{N-1}$ como $\mathcal A\{x\} = X_0,\,\dots,\,X_{N-1}$ donde $$X_k = \sum_{n=0}^{N-1} x_n \phi^*_k(n) \quad \forall k \in \{0,\,\dots\,N-1\}$$ para algunas $\phi^*_k : \{0,\,\dots,\,N-1\} \to \mathbb C$ de forma que para cada $k \in \{0,\,\dots\,N - 1\}$ existe $\phi_k : \{0,\,\dots,\,N-1\} \to \mathbb C$ de forma que para cada $n,\,m$ se tenga que $$\frac 1 N \sum_{k=0}^{N-1} \phi_n(k) \phi^*_m(k) = \left\{ \begin{array}{ccc} 1 & \text{si} & m = n \\ 0 & \text{si} & m \neq n \end{array} \right.$$

Se observa que, si se llama $\Phi$ a la matriz que en la fila $k$ y la columna $n$ contiene el número $\phi_k(n)$ y $\Phi^*$ a la matriz que en la fila $k$ y la columna $n$ contiene el número $\phi^*_k(n)$, entonces las matrices tienen por filas las componentes de $\phi_k$ y $\phi^*_k$ respectivamente, $\mathcal A\{x\}$ puede obtenerse como el producto matricial $\Phi^* x$ y la propiedad queda como que $\Phi^T \Phi^* = N I_{N \times N}$ con $I_{N \times N}$ la matriz identidad. De esta forma, la propiedad expresa relaciones entre cada pareja de vectores $\phi_n$ y $\phi^*_m$. A los vectores $\phi_k$ y $\phi^*_k$ se les llamará **secuencias base**, y esta propiedad que se le exige a las secuencias base se llamará **relaciones de ortogonalidad** aunque no vaya necesariamente ligada a un producto escalar, cosa que ocurriría si se pudiese asociar $\phi^*_k(n)$ con $\phi_k(n)$ a través de una aplicación semilinal $\cdot ^* : \mathbb R \to \mathbb R$ con la cual $\displaystyle (x,\, y) \mapsto \frac 1 N \sum_{k=0}^{N-1} x_k y_k^*$ fuese una forma sesquilineal definida positiva.

Asumiendo que las secuencias base $\phi_k,\, \phi^*_k$ cumplen estas relaciones de ortogonalidad, se tiene que $\Phi^T \Phi^* = N I_{N \times N}$, y por tanto para toda secuencia $x = (x_0,\,\dots\,x_{N-1})^T$ se tiene que $\Phi^T \Phi^* x = N x$; es decir, que $x$ se puede reconstruir como $\frac 1 N \Phi^T \mathcal A\{x\}$, o componente a componente: $$x_n = \frac 1 N \sum_{k=0}^{N-1} X_k \phi_k(n) \quad \forall k \in \{0,\,\dots\,N-1\}$$

y por tanto la transformación $\mathcal A$ tiene inversa (en particular, es un automorfismo). Obsérvese que el caso de la transformada de Fourier discreta es aquel en el que $\phi_k(n) = e^{\frac {2 \pi i k n} N}$ y $\phi^*_k(n) = e^{\frac {-2 \pi i k n} N}$, en cuyo caso $\phi^*_k(n)$ es el conjugado complejo de $\phi_k(n)$ y las relaciones de ortogonalidad son las determinadas por el producto escalar en $\mathbb C^N$.

En general, la información discreta que se almacena en cada muestra de una imagen o un sonido suele tomar un valor en un conjunto ordenado, que se puede interpretar como un subconjunto de $\mathbb R$. Por ello, dado que la transformada de Fourier discreta puede llevar secuencias de números reales en secuencias de números complejos, interesa buscar una transformada discreta dentro de las secuencias de números reales, $\mathcal R: \mathbb R^N \to \mathbb R^N$.

Para obtener una transformada de este tipo no basta tomar parte real en $\phi_k$ y $\phi^*_k$. En este caso, se obtiene $\phi_k(n) = \cos(\frac {2 \pi k n} N)$ y $\phi_k^*(n) = \cos(\frac {-2 \pi k n} N)$. Estas funciones no mantienen la relación de ortogonalidad, puesto que $\phi_k^*(n) = \phi_k^*(N - n)$ debido a la paridad y periodicidad del coseno, y por tanto si fuese cierto que $\frac 1 N \sum_{k=0}^{N-1} \phi_k(n) \phi^*_k(n) = 1$ para todo $n$ entonces también se tendría que $\frac 1 N \sum_{k=0}^{N-1} \phi_k(n) \phi^*_k(N - n) = 1$ para todo $n$, incluyendo aquellos tales que $n \neq N - n$.

En el estándar de imágenes JPEG y diversos estándares de archivos de sonido se usan distintas transformadas discretas, que se obtienen eligiendo distintas secuencias base $\phi_k,\, \phi^*_k$ que estén formadas por números reales y que cumplan las relaciones de ortogonalidad. Estas secuencias se derivan interpretando la secuencia de entrada como parte de una secuencia mayor, extendiéndola de forma periódica y par [@oppenheim1999discrete]. Así, al aplicar la transformada de Fourier discreta sobre la extensión de la secuencia, se anulan las partes imaginarias y se tiene un vector de números reales. Para no trabajar con números complejos, se toma la parte real en los coeficientes de las secuencias base, de forma que finalmente quedan como cosenos, dando lugar a distintos casos (según cómo se realice la extensión de la secuencia) de **transformada discreta del coseno**, o **DCT**, por _Discrete Cosine Transform_.

## Distintas versiones de la transformada discreta del coseno

Dada una secuencia $\{x\} = x_0,\,\dots,\,x_{N-1}$, hay distintas opciones de extenderla de forma simétrica y par, según dónde se tomen los puntos de simetría y según si en primer lugar se hace una extensión impar. Cuatro de ellas son:

1. Simetría par respecto de $0$ y $N-1$ (período $2N - 2$): $$\{\tilde x\}_1 := \dots x_2,\, x_1,\, \underbrace{x_0,\,x_1,\,\dots,\,x_{N-2},\,x_{N-1}}_{\{x\}},\,x_{N-2},\,x_{N-3},\,\dots,\,x_1,\,\underbrace{x_0,\,x_1,\,\dots}_{\{x\}}$$
2. Simetría par respecto de $-\frac 1 2$ y $N - \frac 1 2$ (período $2N$): $$\{\tilde x\}_2 := \dots x_1,\, x_0,\, \underbrace{x_0,\,x_1,\,\dots,\,x_{N-2},\,x_{N-1}}_{\{x\}},\,x_{N-1},\,x_{N-2},\,\dots,\,x_1,\,\underbrace{x_0,\,x_1,\,\dots}_{\{x\}}$$
3. Extensión impar respecto de $N$ y simetría par respecto de $0$ y $2N$ (período $4N$): $$\{\tilde x\}_3 := \dots x_2,\, x_1,\, \underbrace{x_0,\,x_1,\,\dots,\,x_{N-2},\,x_{N-1}}_{\{x\}},\,0,\,-x_{N-1},\,-x_{N-2},$$ $$\dots,\,-x_1,\,\underbrace{-x_0,\,-x_1,\,\dots,\,-x_{N-2},\,-x_{N-1}}_{-\{x\}},\,0,\,x_{N-1},\,\dots,\,x_1,\,\underbrace{x_0,\,x_1,\,\dots}_{\{x\}}$$
4. Extensión impar respecto de $N - \frac 1 2$ y simetría par respecto de $-\frac 1 2$ y $2N - \frac 1 2$ (período $4N$): $$\{\tilde x\}_4 := \dots x_2,\, x_1,\, \underbrace{x_0,\,x_1,\,\dots,\,x_{N-2},\,x_{N-1}}_{\{x\}},\,-x_{N-1},\,-x_{N-2},$$ $$\dots,\,-x_1,\,-x_0,\,\underbrace{-x_0,\,-x_1,\,\dots,\,-x_{N-2},\,-x_{N-1}}_{-\{x\}},\,x_{N-1},\,\dots,\,x_1,\,x_0,\,\underbrace{x_0,\,x_1,\,\dots}_{\{x\}}$$
<!-- TODO: elaborar una figura que ilustre estas simetrías. Spoiler: se ve mucho mejor en una figura -->

A partir de estas secuencias extendidas, tras aplicar la transformada de Fourier discreta, se tiene:

$$(\mathcal F\{\tilde x\}_1)_k = \sum_{n=0}^{2N - 3} (\tilde x_1)_n e^{\frac{-2 \pi i k n}{2N - 2}} = x_0 e^0 + \sum_{n=1}^{N - 2} x_n e^{\frac{-2\pi i k n}{2N - 2}} + x_{N-1} e^{\frac{-2 \pi i k (N-1)}{2N - 2}} + \sum_{n=1}^{N - 2} x_n \underbrace{e^{\frac{-2\pi i k (2N - 2 - n)}{2N - 2}}}_{e^{\frac{+2\pi i k n}{2N - 2}}}$$ $$ = x_0 + 2\sum_{n=1}^{N - 2} x_n Re\ e^{\frac{-2\pi i k n}{2N - 2}} + x_{N-1} e^{-\pi i k} = x_0 + 2 \sum_{n=1}^{N-2} x_n \cos\left(\frac{\pi k n}{N - 1}\right) + (-1)^k x_{N-1}$$

<!-- TODO: la 2 y la 4 aplican simetría por un punto intermedio y hay que explicar que por eso sale el 2n+1 y el 4N -->
$$(\mathcal F\{\tilde x\}_2)_k = \sum_{n=0}^{2N - 1} (\tilde x_2)_n e^{\frac{-2 \pi i k (2n + 1)}{4N}} = \sum_{n=0}^{N-1} x_n e^{\frac{-2 \pi i k (2n + 1)}{4N}} + \sum_{n=0}^{N-1} x_n \underbrace{e^{\frac{-2 \pi i k (4N - 2n - 1)}{4N}}}_{e^{\frac{+2\pi i k (2n + 1)}{4N}}}$$ $$ = 2 \sum_{n=0}^{N-1} x_n Re\ e^{\frac{-2 \pi i k (2n + 1)}{2N}} = 2 \sum_{n=0}^{N-1} x_n \cos\left(\frac{\pi k (2n + 1)}{2N}\right)$$

<!-- TODO: la 3 y la 4 aplican extensión impar y hay que explicar que por eso sale el 2k+1 -->
<!-- TODO: se sale de los márgenes -->
$$(\mathcal F\{\tilde x\}_3)_k = \sum_{n=0}^{4N - 1} (\tilde x_3)_n e^{\frac{-2 \pi i (2k + 1) n}{4N}} = x_0 e^0 + \sum_{n=1}^{N-1} x_n e^{\frac{-2 \pi i (2k + 1) n}{4N}} + 0 - \sum_{n=1}^{N-1} x_n \underbrace{e^{\frac{-2 \pi i k (2N - n)}{4N}}}_{-e^{\frac{+2 \pi i (2k + 1) n}{4N}}} - x_0 e^{\frac{-2 \pi i (2k + 1) (2N)}{4N}}$$ $$ - \sum_{n=1}^{N-1} x_n \underbrace{e^{\frac{-2 \pi i (2k + 1) (2N + n)}{4N}}}_{-e^{\frac{+2 \pi i (2k + 1)(4N - n)}{4N}}} + 0 + \sum_{n=1}^{N-1} x_n e^{\frac{-2 \pi i (2k + 1) (4N - n)}{4N}} = x_0 + 2 \sum_{n=1}^{N-1} x_n Re\ e^{\frac{-2 \pi i k n}{4N}} + x_0 $$ $$ + 2 \sum_{n=1}^{N-1} x_n Re\ e^{\frac{-2 \pi i (2k + 1) (4N - n)}{4N}} = 2 x_0 + 4 \sum_{n=1}^{N-1} x_n \cos \left(\frac{\pi (2k + 1) n}{2N}\right)$$

<!-- TODO: ídem 2 y 3 -->
$$(\mathcal F\{\tilde x\}_4)_k = \sum_{n=0}^{4N - 1} (\tilde x_4)_n e^{\frac{-2 \pi i (2k + 1) (2n + 1)}{8N}} = \sum_{n=0}^{N-1} x_n e^{\frac{-2 \pi i (2k + 1) (2n + 1)}{8N}} - \sum_{n=0}^{N-1} x_n \underbrace{e^{\frac{-2 \pi i (2k + 1) (2N - 2n - 1)}{8N}}}_{-e^{\frac{+2 \pi i (2k + 1)(2n + 1)}{8N}}} $$ $$ - \sum_{n=0}^{N-1} x_n \underbrace{e^{\frac{-2 \pi i (2k + 1) (2N + 2n + 1)}{8N}}}_{-e^{\frac{+2 \pi i (2k + 1) (4N - 2n - 1)}{8N}}} + \sum_{n=0}^{N-1} x_n e^{\frac{-2 \pi i (2k + 1) (4N - 2n - 1)}{8N}} = 2 \sum_{n=0}^{N-1} x_n Re\ e^{\frac{-2 \pi i (2k + 1)(2n + 1)}{8N}} $$ $$ + 2 \sum_{n=0}^{N-1} x_n Re\ e^{\frac{-2 \pi i (2k + 1)(4N - 2n - 1)}{8N}} = 4 \sum_{n=0}^{N-1} x_n \cos\left(\frac{\pi (2k + 1) (2n + 1)}{4N}\right)$$

<!-- TODO: dar nombre a las transformadas que se obtienen y presentar en las formas canónicas (con la variable y las constantes que suelan usar). Dar más propiedades si tienen alguna especial, a ser posible deduciéndolas de que se derivan de la DFT. Probar que la DCT-II es la inversa de la DCT-III -->

## La transformada discreta del coseno estándar (DCT-II)

TODO
<!-- TODO: reformularla y explicar por qué es de especial interés en compresión de archivos -->

## Formato de imagen JPEG

TODO
<!-- TODO: describir brevemente el procedimiento de codificación y decodificación, haciendo énfasis en el uso y utilidad de las DCT-II y DCT-III -->

## Compresión de archivos de sonido

TODO
<!-- TODO: presentar la MDCT. Tratar de ver si cumple algo semejante a las relaciones de ortogonalidad. Mostrar que es invertible a pesar de ir de R^2N a R^N -->
<!-- TODO: describir el uso de la MDCT en compresión de sonido. Si es posible, indicar el especial interés de esta respecto de las DCT estándar -->
